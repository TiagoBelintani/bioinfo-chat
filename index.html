<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioInfo Chat</title>
<meta name="theme-color" content="#2563eb">
<link rel="manifest" href="manifest.json">
<style>
/* --- TODO O SEU CSS ORIGINAL (n√£o mexi) --- */
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <h1>üß¨ BioInfo Chat</h1>
    <p>Especialista em Filogen√¥mica, UCEs e Bioinform√°tica</p>
  </div>

  <div class="chat-container" id="chatContainer">
    <div class="welcome-message" id="welcomeMessage">
      <h2>Ol√°! Como posso ajudar?</h2>
    </div>
  </div>

  <div class="input-container">
    <input id="userInput" placeholder="Digite sua pergunta..." onkeypress="if(event.key==='Enter') sendMessage()">
    <button onclick="sendMessage()">Enviar</button>
  </div>
</div>

<script>
const SYSTEM_PROMPT = `Voc√™ √© um assistente especializado em Bioinform√°tica,
Filogen√¥mica, UCEs e pipelines computacionais.
Responda sempre em portugu√™s brasileiro.`;

let conversationHistory = [];

async function sendMessage() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  document.getElementById("welcomeMessage").style.display = "none";
  addMessage(text, "user");
  input.value = "";

  conversationHistory.push({ role: "user", content: text });

  showTyping();

  try {
    const response = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        messages: [
          { role: "system", content: SYSTEM_PROMPT },
          ...conversationHistory
        ]
      })
    });

    if (!response.ok) throw new Error("Erro no servidor");

    const data = await response.json();
    const reply = data.choices[0].message.content;

    conversationHistory.push({ role: "assistant", content: reply });
    hideTyping();
    addMessage(reply, "assistant");

  } catch (e) {
    hideTyping();
    addMessage("‚ùå Erro ao responder. Verifique o backend.", "assistant");
    console.error(e);
  }
}

function addMessage(text, role) {
  const div = document.createElement("div");
  div.className = "message " + role;
  div.innerHTML = `<div class="message-content">${text.replace(/\n/g,"<br>")}</div>`;
  chatContainer.appendChild(div);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

function showTyping() {
  const t = document.createElement("div");
  t.id = "typing";
  t.className = "message assistant";
  t.innerHTML = "<div class='message-content'>Digitando‚Ä¶</div>";
  chatContainer.appendChild(t);
}

function hideTyping() {
  const t = document.getElementById("typing");
  if (t) t.remove();
}
</script>
</body>
</html>
