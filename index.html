<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BioInfo Chat ‚Äî Bioinform√°tica, √îmicas e Evolu√ß√£o</title>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
               Roboto, Ubuntu, Cantarell, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  height: 100vh;
  display: flex;
  justify-content: center;
}

.container {
  width: 100%;
  max-width: 1100px;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #020617;
}

header {
  padding: 16px 20px;
  border-bottom: 1px solid #1e293b;
}

header h1 {
  font-size: 20px;
}

header p {
  font-size: 13px;
  color: #94a3b8;
}

.warning {
  font-size: 11px;
  color: #fbbf24;
  margin-top: 6px;
}

.controls {
  display: flex;
  gap: 10px;
  padding: 10px 20px;
  border-bottom: 1px solid #1e293b;
  background: #020617;
}

select, button.mode {
  background: #020617;
  border: 1px solid #1e293b;
  color: #e5e7eb;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 13px;
}

button.mode.active {
  background: #2563eb;
  border-color: #2563eb;
}

.chat {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

.message {
  max-width: 750px;
  margin: 0 auto 16px auto;
}

.user { text-align: right; }
.assistant { text-align: left; }

.bubble {
  display: inline-block;
  padding: 12px 16px;
  border-radius: 10px;
  line-height: 1.6;
  white-space: pre-wrap;
}

.user .bubble {
  background: #2563eb;
  color: white;
}

.assistant .bubble {
  background: #0f172a;
  border: 1px solid #1e293b;
}

.error {
  background: #450a0a;
  color: #fecaca;
  border-left: 4px solid #dc2626;
}

.input-area {
  display: flex;
  gap: 10px;
  padding: 14px 20px;
  border-top: 1px solid #1e293b;
}

input {
  flex: 1;
  background: #020617;
  border: 1px solid #1e293b;
  color: #e5e7eb;
  padding: 10px 14px;
  border-radius: 8px;
}

button.send {
  background: #2563eb;
  border: none;
  color: white;
  padding: 10px 18px;
  border-radius: 8px;
  cursor: pointer;
}
</style>
</head>

<body>
<div class="container">

<header>
  <h1>üß¨ BioInfo Chat</h1>
  <p>Bioinform√°tica, √îmicas e Evolu√ß√£o</p>
  <div class="warning">
    Ferramenta acad√™mica experimental. Use de forma cr√≠tica e valide com a literatura.
  </div>
</header>

<div class="controls">
  <button class="mode active" id="freeBtn">Modo Livre</button>
  <button class="mode" id="discBtn">Modo Disciplina</button>

  <select id="preset">
    <option value="general">Bioinform√°tica Geral</option>
    <option value="rnaseq">RNA-seq</option>
    <option value="phylo">Filogenia</option>
    <option value="genomics">Gen√¥mica</option>
  </select>
</div>

<div class="chat" id="chat"></div>

<div class="input-area">
  <input id="input" placeholder="Digite sua pergunta cient√≠fica‚Ä¶" />
  <button class="send" onclick="send()">Enviar</button>
</div>

</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

let mode = "free";
let history = JSON.parse(localStorage.getItem("bioinfo_history")) || [];
let requests = Number(localStorage.getItem("req_count")) || 0;
const LIMIT = 40;

const PRESETS = {
  general: "Voc√™ √© um especialista em Bioinform√°tica, √îmicas e Evolu√ß√£o.",
  rnaseq: "Voc√™ √© um especialista em an√°lise de RNA-seq, express√£o g√™nica e transcript√¥mica.",
  phylo: "Voc√™ √© um especialista em filogenia, filogen√¥mica e evolu√ß√£o molecular.",
  genomics: "Voc√™ √© um especialista em gen√¥mica, montagem e anota√ß√£o gen√¥mica."
};

const PROMPTS = {
  free: "Responda de forma clara e objetiva.",
  discipline:
    "Responda em n√≠vel acad√™mico estruturado: defini√ß√£o, contexto, exemplo e limita√ß√µes."
};

function add(text, role, error=false) {
  const d = document.createElement("div");
  d.className = `message ${role}`;
  const b = document.createElement("div");
  b.className = "bubble" + (error ? " error" : "");
  b.textContent = text;
  d.appendChild(b);
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

function send() {
  if (!input.value.trim()) return;

  if (requests >= LIMIT) {
    add("Limite di√°rio de uso atingido. Tente novamente amanh√£.", "assistant", true);
    return;
  }

  const text = input.value.trim();
  input.value = "";

  add(text, "user");
  history.push({ role: "user", content: text });

  const preset = PRESETS[document.getElementById("preset").value];
  const system =
    preset + " " + PROMPTS[mode];

  fetch("/api/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      messages: [{ role: "system", content: system }, ...history]
    })
  })
  .then(r => r.json())
  .then(d => {
    const reply = d.choices?.[0]?.message?.content;
    if (!reply) throw new Error("Resposta inv√°lida");
    add(reply, "assistant");
    history.push({ role: "assistant", content: reply });
    localStorage.setItem("bioinfo_history", JSON.stringify(history));
    localStorage.setItem("req_count", ++requests);
  })
  .catch(() => add("Erro ao gerar resposta.", "assistant", true));
}

document.getElementById("freeBtn").onclick = () => {
  mode = "free";
  freeBtn.classList.add("active");
  discBtn.classList.remove("active");
};

document.getElementById("discBtn").onclick = () => {
  mode = "discipline";
  discBtn.classList.add("active");
  freeBtn.classList.remove("active");
};
</script>
</body>
</html>

